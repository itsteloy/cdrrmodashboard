{% load static %}
<!-- Add record count and search field -->
<div class="row mb-3 align-items-center">
    <!-- Record count on the left -->
    <div class="col-md-6">
        <span class="badge bg-danger fs-6" id="reportCount">
            Total Referrals: {{ data|length }}
        </span>
    </div>

    <!-- Search field on the right -->
    <div class="col-md-6">
        <div class="input-group ms-auto" style="max-width: 400px;">
            <span class="input-group-text bg-danger">
                <i class="bi bi-search text-white"></i>
            </span>
            <input type="text" id="searchInput" class="form-control" placeholder="Search Reports">
            <button class="btn btn-outline-secondary" type="button" id="clearSearch">
                <i class="bi bi-x-lg"></i>
            </button>
        </div>
    </div>
</div>
<div class="table-responsive shadow-sm rounded">
    <table class="table table-hover table-sm align-middle mb-0" id="mainTable">
        <thead class="table-light">
        <tr>
            <th>Patient Name</th>
            <th>Reason For Referral</th>
            <th>Receiving Institution</th>
            <th>Referring Institution</th>
            <th>Date</th>
            <th>Action</th>
        </tr>
    </thead>
    <tbody>
        {% for doc in data %}
        <tr data-doc-id="{{ doc.id }}">
            <td>{{ doc.patient_name }}</td>
            <td>{{ doc.reason_for_referral }}</td>
            <td>{{ doc.receiving_institution }}</td>
            <td>{{ doc.referring_institution }}</td>
            <td>{{ doc.timestamp }}</td>
            <td>
                <button class="btn btn-primary btn-sm view-details-btn" type="button" data-bs-toggle="modal"
                    data-bs-target="#detailsModal-{{ forloop.counter }}">
                    <i class="bi bi-eye"></i> View Details
                </button>
                
                <button type="button" class="btn btn-warning btn-sm edit-btn" data-bs-toggle="modal" data-bs-target="#editModal"
                    data-id="{{ doc.id }}"
                    data-patient_name="{{ doc.patient_name }}"
                    data-reason_for_referral="{{ doc.reason_for_referral }}"
                    data-receiving_institution="{{ doc.receiving_institution }}"
                    data-referring_institution="{{ doc.referring_institution }}"
                    data-endorsed_by="{{ doc.endorsed_by }}"
                    data-endorsed_to="{{ doc.endorsed_to }}"
                    data-waiver="{{ doc.waiver }}"
                    data-consent_to_care="{{ doc.consent_to_care }}"
                    data-remarks="{{ doc.remarks }}">
                    <i class="bi bi-pencil"></i> Edit
                </button>
                
                <form action="{% url 'delete_referral_record' doc.id %}" method="POST" style="display:inline;">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-danger btn-sm"
                        onclick="return confirm('Are you sure you want to delete this record?');">
                        <i class="bi bi-trash"></i> Delete
                    </button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<!--Details MOdal-->

{% for doc in data %}

<div class="modal fade" id="detailsModal-{{ forloop.counter }}" tabindex="-1" aria-labelledby="detailsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="detailsModalLabel">
                    <i class="bi bi-file-earmatk-medical me-2"></i>
                    Referral Details
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md">
                        <div class="card h-100 border-0 shadow-sm">
                            <div class="card-header bg-primary text-white">
                                <i class="bi bi-person-vcard me-2"></i>Patient Information
                            </div>
                            <div class="card-body">
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <p class="mb-1"><strong>Name:</strong></p>
                                        <p class="text-muted">{{ doc.patient_name }}</p>
                                    </div>
                                    <div class="col-md-6">
                                        <p class="mb-1"><strong>Reason for Referral:</strong></p>
                                        <p class="text-muted">{{ doc.reason_for_referral }}</p>
                                    </div>
                                    <div class="col-md-6">
                                        <p class="mb-1"><strong>Receiving Institution:</strong></p>
                                        <p class="text-muted">{{ doc.receiving_institution }}</p>
                                    </div>
                                    <div class="col-md-6">
                                        <p class="mb-1"><strong>Referring Institution:</strong></p>
                                        <p class="text-muted">{{ doc.referring_institution }}</p>
                                    </div>
                                    <div class="col-md-6">
                                        <p class="mb-1"><strong>Endorsed By:</strong></p>
                                        <p class="text-muted">{{ doc.endorsed_by }}</p>
                                    </div>
                                    <div class="col-md-6">
                                        <p class="mb-1"><strong>Endorsed To:</strong></p>
                                        <p class="text-muted">{{ doc.endorsed_to }}</p>
                                    </div>
                                    <div class="col-md-6">
                                        <p class="mb-1"><strong>Waiver:</strong></p>
                                        <p class="text-muted">{{ doc.waiver }}</p>
                                    </div>
                                    <div class="col-md-6">
                                        <p class="mb-1"><strong>Consent:</strong></p>
                                        <p class="text-muted">{{ doc.consent_to_care }}</p>
                                    </div>
                                    <div class="col-md-6">
                                        <p class="mb-1"><strong>Remarks:</strong></p>
                                        <p class="text-muted">{{ doc.remarks }}</p>
                                    </div>
                                    <div class="col-md-6">
                                        <p class="mb-1"><strong>Date and Time:</strong></p>
                                        <p class="text-muted">{{ doc.timestamp }}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer bg-white">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

{% endfor %}

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="{% static 'dashboardapp/js/editReferralRecords.js' %}"></script>
<script src="{% static 'dashboardapp/js/search-referral.js' %}"></script>
<script src="{% static 'dashboardapp/js/realtime-referral.js' %}"></script>
