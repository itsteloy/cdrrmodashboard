{% load static %}
<div class="row mb-3 align-items-center">
    <!-- Record count on the left -->
    <div class="col-md-6">
        <span class="badge bg-primary fs-6" id="recordCount">
            Total Records: {{ data|length }}
        </span>
    </div>

    <!-- Search field on the right -->
    <div class="col-md-6">
        <div class="input-group ms-auto" style="max-width: 400px;">
            <span class="input-group-text bg-primary">
                <i class="bi bi-search text-white"></i>
            </span>
            <input type="text" id="searchInput" class="form-control" placeholder="Search Records">
            <button class="btn btn-outline-secondary" type="button" id="clearSearch">
                <i class="bi bi-x-lg"></i>
            </button>
        </div>
    </div>
</div>
<!-- Main Table (standardized) -->
<div class="table-responsive shadow-sm rounded">
    <table class="table table-hover table-sm align-middle mb-0" id="mainTable">
        <thead class="table-light">
        <tr>
            <th>Patient Name</th>
            <th>Age</th>
            <th>Chief Complaint</th>
            <th>Pickup Point</th>
            <th>Barangay</th>
            <th>Date of Incident</th>
            <th>Date of Birth</th>
            <th>Action</th>
        </tr>
    </thead>
    <tbody>
        {% for doc in data %}
        <tr data-doc-id="{{ doc.id }}">
            <td>{{ doc.patient_name }}</td>
            <td>{{ doc.age }}</td>
            <td>{{ doc.chief_complaint }}</td>
            <td>{{ doc.pickup_point }}</td>
            <td>{{ doc.barangay }}</td>
            <td>{{ doc.date_of_incident }}</td>
            <td>{{ doc.date_of_birth }}</td>
            <td>
                <!-- View Details Button -->
                <button class="btn btn-primary btn-sm view-details-btn" type="button" data-bs-toggle="modal"
                    data-bs-target="#detailsModal-{{ forloop.counter }}">
                    <i class="bi bi-eye"></i> View Details
                </button>

                <!-- Edit Button -->
                <button type="button" class="btn btn-warning btn-sm edit-btn" data-bs-toggle="modal"
                    data-bs-target="#editModal" 
                    data-id="{{ doc.id }}"
                    data-age="{{ doc.age }}"
                    data-allergy_status="{{ doc.allergy_status }}"
                    data-appearance_observation="{{ doc.appearance_observation }}"
                    data-asthma_status="{{ doc.asthma_status }}"
                    data-barangay="{{ doc.barangay }}"
                    data-bloodloss_observation="{{ doc.bloodloss_observation }}"
                    data-capillary_refill_time="{{ doc.capillary_refill_time }}"
                    data-chief_complaint="{{ doc.chief_complaint }}"
                    data-consent_to_care="{{ doc.consent_to_care }}"
                    data-contact_number="{{ doc.contact_number }}"
                    data-date_of_birth="{{ doc.date_of_birth }}"
                    data-date_of_incident="{{ doc.date_of_incident }}"
                    data-destination="{{ doc.destination }}"
                    data-device_id="{{ doc.device_id }}"
                    data-diabetes_status="{{ doc.diabetes_status }}"
                    data-diastolic_bp="{{ doc.diastolic_bp }}"
                    data-equipment_used="{{ doc.equipment_used }}"
                    data-eye_score="{{ doc.eye_score }}"
                    data-gcs_total="{{ doc.gcs_total }}"
                    data-hypertension_status="{{ doc.hypertension_status }}"
                    data-incident_number="{{ doc.incident_number }}"
                    data-left_pupil_reaction="{{ doc.left_pupil_reaction }}"
                    data-left_pupil_size="{{ doc.left_pupil_size }}"
                    data-medications="{{ doc.medications }}"
                    data-motor_score="{{ doc.motor_score }}"
                    data-nature_of_call="{{ doc.nature_of_call }}"
                    data-noted_by="{{ doc.noted_by }}"
                    data-other_medical_history="{{ doc.other_medical_history }}"
                    data-patient_name="{{ doc.patient_name }}"
                    data-pickup_point="{{ doc.pickup_point }}"
                    data-pulse_ox="{{ doc.pulse_ox }}"
                    data-pulse_rate="{{ doc.pulse_rate }}"
                    data-purok="{{ doc.purok }}"
                    data-remarks="{{ doc.remarks }}"
                    data-respiratory_rate="{{ doc.respiratory_rate }}"
                    data-responding_unit="{{ doc.responding_unit }}"
                    data-right_pupil_reaction="{{ doc.right_pupil_reaction }}"
                    data-right_pupil_size="{{ doc.right_pupil_size }}"
                    data-seizures_status="{{ doc.seizures_status }}"
                    data-sex="{{ doc.sex }}"
                    data-systolic_bp="{{ doc.systolic_bp }}"
                    data-team_leader="{{ doc.team_leader }}"
                    data-team_member="{{ doc.team_member }}"
                    data-team_operator="{{ doc.team_operator }}"
                    data-temperature="{{ doc.temperature }}"
                    data-treatments_given="{{ doc.treatments_given }}"
                    data-verbal_score="{{ doc.verbal_score }}"
                    data-waiver="{{ doc.waiver }}">
                    <i class="bi bi-pencil"></i> Edit
                </button>

                <!-- Delete Button -->
                <form action="{% url 'delete_emergency_record' doc.id %}" method="POST" style="display:inline;">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-danger btn-sm"
                        onclick="return confirm('Are you sure you want to delete this record?');">
                        <i class="bi bi-trash"></i> Delete
                    </button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </tbody>
    </table>
</div>

<!-- Details Modals -->
{% for doc in data %}
<div class="modal fade" id="detailsModal-{{ forloop.counter }}" tabindex="-1" aria-labelledby="detailsModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <!-- Modal Header -->
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="detailsModalLabel">
                    <i class="bi bi-file-earmark-medical me-2"></i>Patient Details
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                    aria-label="Close"></button>
            </div>

            <!-- Modal Body -->
            <div class="modal-body">
                <!-- Modern Card Layout -->
                <div class="row g-4">
                    <!-- Patient Information Card -->
                    <div class="col-md-6">
                        <div class="card h-100 border-0 shadow-sm">
                            <div class="card-header bg-primary text-white">
                                <i class="bi bi-person-vcard me-2"></i>Patient Information
                            </div>
                            <div class="card-body">
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <p class="mb-1"><strong>Name:</strong></p>
                                        <p class="text-muted">{{ doc.patient_name }}</p>
                                    </div>
                                    <div class="col-md-6">
                                        <p class="mb-1"><strong>Age:</strong></p>
                                        <p class="text-muted">{{ doc.age }}</p>
                                    </div>
                                    <div class="col-md-6">
                                        <p class="mb-1"><strong>Date of Birth:</strong></p>
                                        <p class="text-muted">{{ doc.date_of_birth }}</p>
                                    </div>
                                    <div class="col-md-6">
                                        <p class="mb-1"><strong>Sex:</strong></p>
                                        <p class="text-muted">{{ doc.sex }}</p>
                                    </div>
                                    <div class="col-md-12">
                                        <p class="mb-1"><strong>Contact Number:</strong></p>
                                        <p class="text-muted">{{ doc.contact_number }}</p>
                                    </div>
                                    <div class="col-md-6">
                                        <p class="mb-1"><strong>Barangay:</strong></p>
                                        <p class="text-muted">{{ doc.barangay }}</p>
                                    </div>
                                    <div class="col-md-6">
                                        <p class="mb-1"><strong>Purok:</strong></p>
                                        <p class="text-muted">{{ doc.purok }}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Incident Information Card -->
                    <div class="col-md-6">
                        <div class="card h-100 border-0 shadow-sm">
                            <div class="card-header bg-primary text-white">
                                <i class="bi bi-clipboard2-pulse me-2"></i>Incident Information
                            </div>
                            <div class="card-body">
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <p class="mb-1"><strong>Chief Complaint:</strong></p>
                                        <p class="text-muted">{{ doc.chief_complaint }}</p>
                                    </div>
                                    <div class="col-md-6">
                                        <p class="mb-1"><strong>Date of Incident:</strong></p>
                                        <p class="text-muted">{{ doc.date_of_incident }}</p>
                                    </div>
                                    <div class="col-md-6">
                                        <p class="mb-1"><strong>Nature of Call:</strong></p>
                                        <p class="text-muted">{{ doc.nature_of_call }}</p>
                                    </div>
                                    <div class="col-md-6">
                                        <p class="mb-1"><strong>Incident Number:</strong></p>
                                        <p class="text-muted">{{ doc.incident_number }}</p>
                                    </div>
                                    <div class="col-md-6">
                                        <p class="mb-1"><strong>Destination:</strong></p>
                                        <p class="text-muted">{{ doc.destination }}</p>
                                    </div>
                                    <div class="col-md-6">
                                        <p class="mb-1"><strong>Pickup Point:</strong></p>
                                        <p class="text-muted">{{ doc.pickup_point }}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Medical Information Card -->
                    <div class="col-md-6">
                        <div class="card h-100 border-0 shadow-sm">
                            <div class="card-header bg-primary text-white">
                                <i class="bi bi-heart-pulse me-2"></i>Medical Information
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="row g-3">
                                            <div class="col-12">
                                                <p class="mb-1"><strong>Allergy Status:</strong></p>
                                                <p class="text-muted">{{ doc.allergy_status }}</p>
                                            </div>
                                            <div class="col-12">
                                                <p class="mb-1"><strong>Asthma Status:</strong></p>
                                                <p class="text-muted">{{ doc.asthma_status }}</p>
                                            </div>
                                            <div class="col-12">
                                                <p class="mb-1"><strong>Diabetes Status:</strong></p>
                                                <p class="text-muted">{{ doc.diabetes_status }}</p>
                                            </div>
                                            <div class="col-12">
                                                <p class="mb-1"><strong>Hypertension Status:</strong></p>
                                                <p class="text-muted">{{ doc.hypertension_status }}</p>
                                            </div>
                                            <div class="col-12">
                                                <p class="mb-1"><strong>Seizures Status:</strong></p>
                                                <p class="text-muted">{{ doc.seizures_status }}</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="row g-3">
                                            <div class="col-12">
                                                <p class="mb-1"><strong>Other Medical History:</strong></p>
                                                <p class="text-muted">{{ doc.other_medical_history }}</p>
                                            </div>
                                            <div class="col-12">
                                                <p class="mb-1"><strong>Medications:</strong></p>
                                                <p class="text-muted">{{ doc.medications }}</p>
                                            </div>
                                            <div class="col-12">
                                                <p class="mb-1"><strong>Treatments Given:</strong></p>
                                                <p class="text-muted">{{ doc.treatments_given }}</p>
                                            </div>
                                            <div class="col-12">
                                                <p class="mb-1"><strong>Equipment Used:</strong></p>
                                                <p class="text-muted">{{ doc.equipment_used }}</p>
                                            </div>
                                        </div>
                                    </div>         
                                </div>                  
                            </div>
                        </div>
                    </div>
                    
                    <!-- Vital Signs Card -->
                    <div class="col-md-6">
                        <div class="card h-100 border-0 shadow-sm">
                            <div class="card-header bg-primary text-white">
                                <i class="bi bi-speedometer2 me-2"></i>Vital Signs
                            </div>
                            <div class="card-body">
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <p class="mb-1"><strong>Blood Pressure:</strong></p>
                                        <p class="text-muted">{{ doc.systolic_bp }}/{{ doc.diastolic_bp }} mmHg</p>
                                    </div>
                                    <div class="col-md-6">
                                        <p class="mb-1"><strong>Pulse Rate:</strong></p>
                                        <p class="text-muted">{{ doc.pulse_rate }} bpm</p>
                                    </div>
                                    <div class="col-md-6">
                                        <p class="mb-1"><strong>Respiratory Rate:</strong></p>
                                        <p class="text-muted">{{ doc.respiratory_rate }} breaths/min</p>
                                    </div>
                                    <div class="col-md-6">
                                        <p class="mb-1"><strong>Temperature:</strong></p>
                                        <p class="text-muted">{{ doc.temperature }} °C</p>
                                    </div>
                                    <div class="col-md-6">
                                        <p class="mb-1"><strong>Pulse Ox:</strong></p>
                                        <p class="text-muted">{{ doc.pulse_ox }}%</p>
                                    </div>
                                    <div class="col-md-6">
                                        <p class="mb-1"><strong>Capillary Refill:</strong></p>
                                        <p class="text-muted">{{ doc.capillary_refill_time }} sec</p>
                                    </div>
                                    <div class="col-md-6">
                                        <p class="mb-1"><strong>Eye Score:</strong></p>
                                        <p class="text-muted">{{ doc.eye_score }}</p>
                                    </div>
                                    <div class="col-md-6">
                                        <p class="mb-1"><strong>Motor Score:</strong></p>
                                        <p class="text-muted">{{ doc.motor_score }}</p>
                                    </div>
                                    <div class="col-md-6">
                                        <p class="mb-1"><strong>Verbal Score:</strong></p>
                                        <p class="text-muted">{{ doc.verbal_score }}</p>
                                    </div>
                                    <div class="col-md-6">
                                        <p class="mb-1"><strong>GCS Total:</strong></p>
                                        <p class="text-muted">{{ doc.gcs_total }}</p>
                                    </div>
                                    
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Additional Information Card -->
                    <div class="col-12">
                        <div class="card border-0 shadow-sm">
                            <div class="card-header bg-primary text-white">
                                <i class="bi bi-info-circle me-2"></i>Additional Information
                            </div>
                            <div class="card-body">
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <p class="mb-1"><strong>Responding Unit:</strong></p>
                                        <p class="text-muted">{{ doc.responding_unit }}</p>
                                    </div>
                                    <div class="col-md-6">
                                        <p class="mb-1"><strong>Team Leader:</strong></p>
                                        <p class="text-muted">{{ doc.team_leader }}</p>
                                    </div>
                                    <div class="col-md-6">
                                        <p class="mb-1"><strong>Team Operator:</strong></p>
                                        <p class="text-muted">{{ doc.team_operator }}</p>
                                    </div>
                                    <div class="col-md-6">
                                        <p class="mb-1"><strong>Team Member:</strong></p>
                                        <p class="text-muted">{{ doc.team_member }}</p>
                                    </div>
                                    <div class="col-md-6">
                                        <p class="mb-1"><strong>Officer In-charge:</strong></p>
                                        <p class="text-muted">{{ doc.noted_by }}</p>
                                    </div>
                                    <div class="col-md-12">
                                        <p class="mb-1"><strong>Remarks:</strong></p>
                                        <p class="text-muted">{{ doc.remarks }}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Modal Footer -->
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
{% endfor %}

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<script src="{% static 'dashboardapp/js/editEmergencyRecords.js' %}"></script>
<script src="{% static 'dashboardapp/js/searchRecords.js' %}"></script>
<script src="{% static 'dashboardapp/js/realtime-emergency.js' %}"></script>
